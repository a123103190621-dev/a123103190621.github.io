<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>笨兔子和小熊猫的恋爱记账本</title>
    <style>
        :root {
            --primary-color: #f8bbd0; /* 浅粉色 */
            --secondary-color: #bbdefb; /* 浅蓝色 */
            --background-color: #f5f5f5; /* 灰白色背景 */
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 60px;
        }

        /* 下雨背景效果 */
        .rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .drop {
            position: absolute;
            width: 1px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, #a1c4fd);
            animation: rain linear infinite;
        }

        @keyframes rain {
            0% {
                transform: translateY(-100vh);
            }
            100% {
                transform: translateY(100vh);
            }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid var(--primary-color);
        }

        .title {
            font-size: 18px;
            font-weight: bold;
            color: #5c6bc0;
        }

        .account-buttons {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .account-button {
            flex: 1;
            padding: 12px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .account-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .account-button:first-child {
            border-right: 1px solid var(--border-color);
        }

        .ledger-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .ledger-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .ledger-tab.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .ledger-tab:first-child {
            border-right: 1px solid var(--border-color);
        }

        .balance-display {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
            text-align: center;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #5c6bc0;
        }

        .time-filter {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .time-filter button {
            padding: 8px 15px;
            margin: 0 5px;
            border: 1px solid var(--border-color);
            background-color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-filter button.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .record-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .radio-option {
            display: none;
        }

        .radio-label {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .radio-option:checked + .radio-label {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .account-select {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .account-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .account-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background-color: #f48fb1;
        }

        .image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
        }

        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            display: none;
        }

        .upload-btn {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background-color: #8c9eff;
        }

        .records-list {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .record-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .record-amount {
            font-weight: bold;
            color: #5c6bc0;
        }

        .record-expense {
            color: #e53935;
        }

        .record-deposit {
            color: #43a047;
        }

        .record-category {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-right: 5px;
        }

        .record-account {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px;
            font-size: 12px;
        }

        .record-time {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }

        .record-note {
            margin: 5px 0;
        }

        .record-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 5px;
            margin-top: 10px;
            display: block;
        }

        .record-comment {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
        }

        .comment-author {
            font-weight: bold;
            color: #5c6bc0;
            margin-bottom: 5px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #e53935;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .record-item:hover .delete-btn {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .avatar-option:hover {
            border-color: var(--primary-color);
        }

        .avatar-option.selected {
            border-color: var(--secondary-color);
        }

        .edit-name {
            margin-top: 15px;
        }

        .edit-name input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .save-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .no-records {
            text-align: center;
            padding: 30px;
            color: #777;
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .account-button, .ledger-tab {
                padding: 10px;
                font-size: 14px;
            }
            
            .balance-amount {
                font-size: 20px;
            }
            
            .radio-label {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 下雨背景 -->
    <div class="rain" id="rain"></div>

    <div class="container">
        <header>
            <div class="header-left">
                <img src="https://i.imgur.com/JqYeXvn.png" alt="头像" class="avatar" id="userAvatar">
                <div>
                    <div class="title" id="appTitle">笨兔子和小熊猫的恋爱记账本</div>
                    <div id="currentDate"></div>
                </div>
            </div>
        </header>

        <div class="account-buttons">
            <button class="account-button active" id="depositBtn">存钱</button>
            <button class="account-button" id="expenseBtn">花钱</button>
        </div>

        <div class="ledger-tabs">
            <button class="ledger-tab active" id="loveLedgerBtn">和凌肖的恋爱小荷包</button>
            <button class="ledger-tab" id="dailyLedgerBtn">日常开销</button>
        </div>

        <div class="balance-display">
            <div id="balanceLabel">当前存款余额</div>
            <div class="balance-amount" id="balanceAmount">¥0.00</div>
        </div>

        <div class="time-filter">
            <button class="active" data-period="all">全部</button>
            <button data-period="week">本周</button>
            <button data-period="month">本月</button>
            <button data-period="year">本年</button>
        </div>

        <div class="record-form">
            <div class="form-group">
                <label for="amount">金额</label>
                <input type="number" id="amount" class="form-control" placeholder="输入金额">
            </div>

            <div class="form-group">
                <label>账户</label>
                <div class="account-select">
                    <div class="account-option active" data-account="微信">微信</div>
                    <div class="account-option" data-account="支付宝">支付宝</div>
                    <div class="account-option" data-account="银行卡">银行卡</div>
                </div>
            </div>

            <div class="form-group" id="categoryGroup">
                <label>分类</label>
                <div class="radio-group">
                    <input type="radio" name="category" id="category1" value="零食" class="radio-option" checked>
                    <label for="category1" class="radio-label">零食</label>

                    <input type="radio" name="category" id="category2" value="衣服" class="radio-option">
                    <label for="category2" class="radio-label">衣服</label>

                    <input type="radio" name="category" id="category3" value="交通" class="radio-option">
                    <label for="category3" class="radio-label">交通</label>

                    <input type="radio" name="category" id="category4" value="旅行" class="radio-option">
                    <label for="category4" class="radio-label">旅行</label>

                    <input type="radio" name="category" id="category5" value="话费网费" class="radio-option">
                    <label for="category5" class="radio-label">话费网费</label>

                    <input type="radio" name="category" id="category6" value="学习" class="radio-option">
                    <label for="category6" class="radio-label">学习</label>

                    <input type="radio" name="category" id="category7" value="日用品" class="radio-option">
                    <label for="category7" class="radio-label">日用品</label>

                    <input type="radio" name="category" id="category8" value="美妆" class="radio-option">
                    <label for="category8" class="radio-label">美妆</label>

                    <input type="radio" name="category" id="category9" value="医疗" class="radio-option">
                    <label for="category9" class="radio-label">医疗</label>

                    <input type="radio" name="category" id="category10" value="娱乐" class="radio-option">
                    <label for="category10" class="radio-label">娱乐</label>

                    <input type="radio" name="category" id="category11" value="人情往来" class="radio-option">
                    <label for="category11" class="radio-label">人情往来</label>

                    <input type="radio" name="category" id="category12" value="运动" class="radio-option">
                    <label for="category12" class="radio-label">运动</label>

                    <input type="radio" name="category" id="category13" value="水电煤" class="radio-option">
                    <label for="category13" class="radio-label">水电煤</label>

                    <input type="radio" name="category" id="category14" value="其他" class="radio-option">
                    <label for="category14" class="radio-label">其他</label>
                </div>
            </div>

            <div class="form-group">
                <label for="note">备注</label>
                <input type="text" id="note" class="form-control" placeholder="添加备注">
            </div>

            <div class="image-upload">
                <img id="imagePreview" class="image-preview" alt="图片预览">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button class="upload-btn" id="uploadBtn">上传图片</button>
            </div>

            <button class="submit-btn" id="submitBtn">记录</button>
        </div>

        <div class="records-list" id="recordsList">
            <!-- 记录将在这里动态添加 -->
        </div>
    </div>

    <!-- 头像选择模态框 -->
    <div class="modal" id="avatarModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>选择头像</h3>
            <div class="avatar-options">
                <img src="https://i.imgur.com/JqYeXvn.png" class="avatar-option selected" data-avatar="https://i.imgur.com/JqYeXvn.png">
                <img src="https://i.imgur.com/5XZwW7B.png" class="avatar-option" data-avatar="https://i.imgur.com/5XZwW7B.png">
                <img src="https://i.imgur.com/8Km9tLL.png" class="avatar-option" data-avatar="https://i.imgur.com/8Km9tLL.png">
                <img src="https://i.imgur.com/vZ6TQhJ.png" class="avatar-option" data-avatar="https://i.imgur.com/vZ6TQhJ.png">
                <img src="https://i.imgur.com/q7ND2kK.png" class="avatar-option" data-avatar="https://i.imgur.com/q7ND2kK.png">
                <img src="https://i.imgur.com/3JYQ1dY.png" class="avatar-option" data-avatar="https://i.imgur.com/3JYQ1dY.png">
            </div>
            <div class="edit-name">
                <h3>修改昵称</h3>
                <input type="text" id="nameInput" placeholder="输入昵称">
                <button class="save-btn" id="saveNameBtn">保存</button>
            </div>
        </div>
    </div>

    <script>
        // 凌肖的评论
        const lingXiaoComments = {
            deposit: [
                "看来我们的旅游资金又增加了。",
                "存钱可以，别饿着肚子。",
                "又加班了？不如存点时间陪我。",
                "我们的未来基金+1",
                "去吃火锅怎么样？我现在去找你。",
                "要不要来live house看我演出？",
                "行，下次带你去吃好吃的。",
                "积少成多，这么着急干什么，我来找你了。",
                "笨兔子理财能力见长啊。",
                "啧，看来要准备个更大的存钱罐了。",
                "啧，别累着自己，晚上我去接你。",
                "可以啊，这么能干。",
                "livehouse第一排的位置给你留着呢，大制作人什么时候赏脸？",
                "假期想去哪儿玩？反正和你一起，去哪儿都可以。",
                "走，带你吃顿好的。"
            ],
            expense: {
                零食: [
                    "又背着我吃独食？",
                    "啧，怎么不带我一起？",
                    "独乐乐不如众乐乐，分我一点。",
                    "下次给我买零食就够了，adam他们不要。",
                    "就这么点？够你塞牙缝？",
                    "你是不是又背着我偷吃了？"
                ],
                衣服: [
                    "买新衣服了？怎么不带我去。",
                    "眼光不错，果然和我呆久了笨兔子的审美都提升了不少。",
                    "买这么多新衣服，什么时候和我出来逛逛？",
                    "情侣装啊，我考虑一下"
                ],
                交通: [
                    "去哪儿了？怎么不叫我一起？",
                    "啧，这么远？下次我送你。",
                    "Adam他们问你什么时候来live house",
                    "到家了？我来找你了。",
                    "下次滑滑板带你。"
                ],
                旅行: [
                    "怎么不带我？",
                    "玩得开心吗，笨兔子。",
                    "啧，照片发我看看。",
                    "下次我们一起去。",
                    "想我了没？"
                ],
                话费网费: [
                    "跟谁聊这么久？",
                    "知道了。"
                ],
                学习: [
                    "啧，品学兼优这四个字懂吗？就是专门形容我的。",
                    "啧，别读傻了。",
                    "行，学习是好事。",
                    "看不懂的来问我。"
                ],
                日用品: [
                    "买的什么？我看看。",
                    "嗯，这些是该买了。",
                    "还缺什么，列个单子给我。"
                ],
                美妆: [
                    "看我干什么？我现在可分得清口红色号了。",
                    "这是什么？",
                    "上次的那个口红比较好吃。",
                    "这些瓶瓶罐罐的看着就头晕。",
                    "让我看看买了什么新东西。"
                ],
                医疗: [
                    "生病了？怎么不告诉我。",
                    "啧，笨兔子，会不会照顾自己。",
                    "哪不舒服？我现在过去。",
                    "我现在过去。"
                ],
                娱乐: [
                    "去看live了？哪个乐队？",
                    "打游戏吗？一起。",
                    "上线怎么不喊我。",
                    "明天陪我去碗池滑两圈。",
                    "这周日live house的演出——你会来的吧。",
                    "下个假期，我先预定了。",
                    "不喊我一起？",
                    "他们技术哪有我高。"
                ],
                人情往来: [
                    "什么人情？",
                    "嗯，知道了。"
                ],
                运动: [
                    "去运动了？真是难得。",
                    "不如陪我去滑滑板，保你能吃好睡好",
                    "怎么不喊我一起？",
                    "哟，太阳打西边出来了。",
                    "开门，我带了烧烤。",
                    "减什么肥啊，你哪儿胖了？"
                ],
                水电煤: [
                    "生活费。",
                    "知道了。",
                    "嗯。"
                ],
                其他: [
                    "这又是什么？",
                    "给你捏了个兔子。",
                    "？解释一下。",
                    "行吧。",
                    "我看看。",
                    "嗯。"
                ]
            }
        };

        // 全局变量
        let currentAccountType = 'deposit'; // deposit or expense
        let currentLedger = 'love'; // love or daily
        let currentPeriod = 'all'; // all, week, month, year
        let selectedAccount = '微信';
        let selectedCategory = '零食';
        let records = JSON.parse(localStorage.getItem('records')) || [];
        let usedComments = JSON.parse(localStorage.getItem('usedComments')) || {};
        let userName = localStorage.getItem('userName') || '笨兔子';
        let partnerName = localStorage.getItem('partnerName') || '凌肖';
        let userAvatar = localStorage.getItem('userAvatar') || 'https://i.imgur.com/JqYeXvn.png';
        let appTitle = localStorage.getItem('appTitle') || '笨兔子和小熊猫的恋爱记账本';

        // DOM元素
        const depositBtn = document.getElementById('depositBtn');
        const expenseBtn = document.getElementById('expenseBtn');
        const loveLedgerBtn = document.getElementById('loveLedgerBtn');
        const dailyLedgerBtn = document.getElementById('dailyLedgerBtn');
        const balanceLabel = document.getElementById('balanceLabel');
        const balanceAmount = document.getElementById('balanceAmount');
        const amountInput = document.getElementById('amount');
        const noteInput = document.getElementById('note');
        const categoryGroup = document.getElementById('categoryGroup');
        const accountOptions = document.querySelectorAll('.account-option');
        const submitBtn = document.getElementById('submitBtn');
        const recordsList = document.getElementById('recordsList');
        const timeFilterButtons = document.querySelectorAll('.time-filter button');
        const avatarModal = document.getElementById('avatarModal');
        const userAvatarElement = document.getElementById('userAvatar');
        const closeModal = document.querySelector('.close-modal');
        const avatarOptions = document.querySelectorAll('.avatar-option');
        const nameInput = document.getElementById('nameInput');
        const saveNameBtn = document.getElementById('saveNameBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const appTitleElement = document.getElementById('appTitle');
        const currentDateElement = document.getElementById('currentDate');

        // 初始化
        function init() {
            // 设置当前日期
            updateCurrentDate();
            
            // 设置应用标题
            appTitleElement.textContent = appTitle;
            
            // 设置头像
            userAvatarElement.src = userAvatar;
            
            // 加载记录
            filterRecords();
            
            // 更新余额显示
            updateBalance();
            
            // 事件监听器
            depositBtn.addEventListener('click', () => {
                setAccountType('deposit');
            });
            
            expenseBtn.addEventListener('click', () => {
                setAccountType('expense');
            });
            
            loveLedgerBtn.addEventListener('click', () => {
                setLedger('love');
            });
            
            dailyLedgerBtn.addEventListener('click', () => {
                setLedger('daily');
            });
            
            accountOptions.forEach(option => {
                option.addEventListener('click', () => {
                    accountOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    selectedAccount = option.dataset.account;
                });
            });
            
            document.querySelectorAll('input[name="category"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    selectedCategory = radio.value;
                });
            });
            
            submitBtn.addEventListener('click', addRecord);
            
            timeFilterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    timeFilterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentPeriod = button.dataset.period;
                    filterRecords();
                });
            });
            
            // 头像相关事件
            userAvatarElement.addEventListener('click', () => {
                avatarModal.style.display = 'flex';
            });
            
            closeModal.addEventListener('click', () => {
                avatarModal.style.display = 'none';
            });
            
            avatarOptions.forEach(option => {
                option.addEventListener('click', () => {
                    avatarOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    userAvatar = option.dataset.avatar;
                    userAvatarElement.src = userAvatar;
                });
            });
            
            nameInput.value = userName;
            
            saveNameBtn.addEventListener('click', () => {
                userName = nameInput.value.trim() || '笨兔子';
                localStorage.setItem('userName', userName);
                localStorage.setItem('partnerName', partnerName);
                localStorage.setItem('appTitle', appTitle);
                avatarModal.style.display = 'none';
            });
            
            // 图片上传
            uploadBtn.addEventListener('click', () => {
                imageUpload.click();
            });
            
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // 长按修改名称
            appTitleElement.addEventListener('longpress', () => {
                const newTitle = prompt('请输入新的账本名称:', appTitle);
                if (newTitle && newTitle.trim() !== '') {
                    appTitle = newTitle.trim();
                    appTitleElement.textContent = appTitle;
                    localStorage.setItem('appTitle', appTitle);
                    updateAccountButtonText();
                }
            });
            
            // 长按事件模拟
            let pressTimer;
            appTitleElement.addEventListener('mousedown', () => {
                pressTimer = setTimeout(() => {
                    const newTitle = prompt('请输入新的账本名称:', appTitle);
                    if (newTitle && newTitle.trim() !== '') {
                        appTitle = newTitle.trim();
                        appTitleElement.textContent = appTitle;
                        localStorage.setItem('appTitle', appTitle);
                        updateAccountButtonText();
                    }
                }, 1000);
            });
            
            appTitleElement.addEventListener('mouseup', () => {
                clearTimeout(pressTimer);
            });
            
            appTitleElement.addEventListener('mouseleave', () => {
                clearTimeout(pressTimer);
            });
            
            appTitleElement.addEventListener('touchstart', () => {
                pressTimer = setTimeout(() => {
                    const newTitle = prompt('请输入新的账本名称:', appTitle);
                    if (newTitle && newTitle.trim() !== '') {
                        appTitle = newTitle.trim();
                        appTitleElement.textContent = appTitle;
                        localStorage.setItem('appTitle', appTitle);
                        updateAccountButtonText();
                    }
                }, 1000);
            });
            
            appTitleElement.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
            });
            
            // 创建下雨效果
            createRain();
        }
        
        // 更新当前日期
        function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            currentDateElement.textContent = now.toLocaleDateString('zh-CN', options);
        }
        
        // 更新账户按钮文本
        function updateAccountButtonText() {
            if (currentLedger === 'love') {
                depositBtn.textContent = '存钱';
                expenseBtn.textContent = '花钱';
            } else {
                depositBtn.textContent = '收入';
                expenseBtn.textContent = '支出';
            }
        }
        
        // 设置账户类型
        function setAccountType(type) {
            currentAccountType = type;
            depositBtn.classList.remove('active');
            expenseBtn.classList.remove('active');
            
            if (type === 'deposit') {
                depositBtn.classList.add('active');
                categoryGroup.style.display = 'none';
            } else {
                expenseBtn.classList.add('active');
                categoryGroup.style.display = 'block';
            }
            
            updateBalance();
        }
        
        // 设置账本
        function setLedger(ledger) {
            currentLedger = ledger;
            loveLedgerBtn.classList.remove('active');
            dailyLedgerBtn.classList.remove('active');
            
            if (ledger === 'love') {
                loveLedgerBtn.classList.add('active');
            } else {
                dailyLedgerBtn.classList.add('active');
            }
            
            updateAccountButtonText();
            updateBalance();
            filterRecords();
        }
        
        // 更新余额显示
        function updateBalance() {
            const filteredRecords = records.filter(record => 
                record.ledger === currentLedger && 
                (currentPeriod === 'all' || isInPeriod(record.date, currentPeriod))
            );
            
            let balance = 0;
            let totalExpense = 0;
            let totalDeposit = 0;
            
            filteredRecords.forEach(record => {
                if (record.type === 'deposit') {
                    balance += record.amount;
                    totalDeposit += record.amount;
                } else {
                    balance -= record.amount;
                    totalExpense += record.amount;
                }
            });
            
            if (currentAccountType === 'deposit') {
                balanceLabel.textContent = currentLedger === 'love' ? '恋爱基金余额' : '当前存款余额';
                balanceAmount.textContent = `¥${balance.toFixed(2)}`;
            } else {
                balanceLabel.textContent = currentLedger === 'love' ? '恋爱总花费' : '本月总支出';
                balanceAmount.textContent = `¥${totalExpense.toFixed(2)}`;
            }
        }
        
        // 检查日期是否在指定周期内
        function isInPeriod(dateString, period) {
            const date = new Date(dateString);
            const now = new Date();
            
            if (period === 'week') {
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                startOfWeek.setHours(0, 0, 0, 0);
                return date >= startOfWeek;
            } else if (period === 'month') {
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            } else if (period === 'year') {
                return date.getFullYear() === now.getFullYear();
            }
            
            return true;
        }
        
        // 添加记录
        function addRecord() {
            const amount = parseFloat(amountInput.value);
            const note = noteInput.value.trim();
            
            if (isNaN(amount) || amount <= 0) {
                alert('请输入有效的金额');
                return;
            }
            
            const record = {
                id: Date.now(),
                type: currentAccountType,
                ledger: currentLedger,
                amount: amount,
                account: selectedAccount,
                category: selectedCategory,
                note: note,
                date: new Date().toISOString(),
                image: imagePreview.style.display === 'block' ? imagePreview.src : null,
                comment: generateComment(currentAccountType, amount, selectedCategory)
            };
            
            records.push(record);
            saveRecords();
            
            // 重置表单
            amountInput.value = '';
            noteInput.value = '';
            imagePreview.style.display = 'none';
            imagePreview.src = '';
            imageUpload.value = '';
            
            filterRecords();
            updateBalance();
        }
        
        // 生成评论
        function generateComment(type, amount, category) {
            let comments = [];
            
            if (type === 'deposit') {
                // 存款评论
                comments = lingXiaoComments.deposit.filter(comment => 
                    !usedComments.deposit || !usedComments.deposit.includes(comment)
                );
                
                if (comments.length === 0) {
                    comments = lingXiaoComments.deposit;
                    usedComments.deposit = [];
                }
                
                const randomComment = comments[Math.floor(Math.random() * comments.length)];
                
                // 记录已使用的评论
                if (!usedComments.deposit) {
                    usedComments.deposit = [];
                }
                usedComments.deposit.push(randomComment);
                localStorage.setItem('usedComments', JSON.stringify(usedComments));
                
                return randomComment;
            } else {
                // 支出评论
                comments = lingXiaoComments.expense[category].filter(comment => 
                    !usedComments[category] || !usedComments[category].includes(comment)
                );
                
                if (comments.length === 0) {
                    comments = lingXiaoComments.expense[category];
                    usedComments[category] = [];
                }
                
                const randomComment = comments[Math.floor(Math.random() * comments.length)];
                
                // 记录已使用的评论
                if (!usedComments[category]) {
                    usedComments[category] = [];
                }
                usedComments[category].push(randomComment);
                localStorage.setItem('usedComments', JSON.stringify(usedComments));
                
                // 根据金额添加额外评论
                let additionalComments = [];
                if (amount > 200) {
                    additionalComments.push("啧，买这么多，你这是把店搬空了？");
                } else if (amount < 10) {
                    additionalComments.push("蚊子腿也是肉。", "啧，晚上去吃顿好的？");
                }
                
                if (additionalComments.length > 0) {
                    return `${randomComment} ${additionalComments[Math.floor(Math.random() * additionalComments.length)]}`;
                }
                
                return randomComment;
            }
        }
        
        // 保存记录到本地存储
        function saveRecords() {
            localStorage.setItem('records', JSON.stringify(records));
        }
        
        // 过滤并显示记录
        function filterRecords() {
            const filteredRecords = records.filter(record => 
                record.ledger === currentLedger && 
                record.type === currentAccountType &&
                (currentPeriod === 'all' || isInPeriod(record.date, currentPeriod))
            ).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            displayRecords(filteredRecords);
        }
        
        // 显示记录
        function displayRecords(recordsToDisplay) {
            recordsList.innerHTML = '';
            
            if (recordsToDisplay.length === 0) {
                recordsList.innerHTML = '<div class="no-records">暂无记录</div>';
                return;
            }
            
            recordsToDisplay.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                recordItem.dataset.id = record.id;
                
                const date = new Date(record.date);
                const formattedDate = `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日 ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                recordItem.innerHTML = `
                    <div class="record-header">
                        <div>
                            <span class="record-category">${record.category}</span>
                            <span class="record-account">${record.account}</span>
                        </div>
                        <div class="record-amount ${record.type === 'deposit' ? 'record-deposit' : 'record-expense'}">
                            ${record.type === 'deposit' ? '+' : '-'}¥${record.amount.toFixed(2)}
                        </div>
                    </div>
                    ${record.note ? `<div class="record-note">${record.note}</div>` : ''}
                    ${record.image ? `<img src="${record.image}" class="record-image">` : ''}
                    ${record.comment && record.ledger === 'love' ? `
                        <div class="record-comment">
                            <div class="comment-author">${partnerName}</div>
                            <div>${record.comment}</div>
                        </div>
                    ` : ''}
                    <div class="record-time">${formattedDate}</div>
                    <button class="delete-btn">×</button>
                `;
                
                recordsList.appendChild(recordItem);
                
                // 添加删除按钮事件
                const deleteBtn = recordItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm('确定要删除这条记录吗？')) {
                        deleteRecord(record.id);
                    }
                });
            });
        }
        
        // 删除记录
        function deleteRecord(id) {
            records = records.filter(record => record.id !== id);
            saveRecords();
            filterRecords();
            updateBalance();
        }
        
        // 创建下雨效果
        function createRain() {
            const rainContainer = document.getElementById('rain');
            const dropsCount = 100;
            
            for (let i = 0; i < dropsCount; i++) {
                const drop = document.createElement('div');
                drop.className = 'drop';
                drop.style.left = `${Math.random() * 100}%`;
                drop.style.top = `${Math.random() * -100}%`;
                drop.style.animationDuration = `${0.5 + Math.random() * 1}s`;
                drop.style.animationDelay = `${Math.random() * 2}s`;
                rainContainer.appendChild(drop);
            }
        }
        
        // 初始化应用
        init();
    </script>
</body>
</html>