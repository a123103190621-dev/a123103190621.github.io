<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>笨兔子和小熊猫的恋爱记账本</title>
    <style>
        :root {
            --bg-color: #f9f5ff;
            --primary-color: #5d5fef;
            --secondary-color: #ff85a2;
            --accent-color: #7b68ee;
            --text-color: #4a4a6a;
            --light-text: #ffffff;
            --border-color: #e0d6ff;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(93, 95, 239, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* 雨滴背景效果 */
        .raindrop {
            position: absolute;
            width: 1px;
            height: 15px;
            background: linear-gradient(to bottom, rgba(123, 104, 238, 0.3), transparent);
            animation: rain linear infinite;
            z-index: -1;
        }

        @keyframes rain {
            0% {
                transform: translateY(-100vh);
            }
            100% {
                transform: translateY(100vh);
            }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            background-color: rgba(249, 245, 255, 0.85);
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary-color);
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--secondary-color);
            transition: all 0.3s;
        }

        .avatar:hover {
            transform: scale(1.1);
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: var(--text-color);
        }

        .tab.active {
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .balance-card {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        .balance-title {
            font-size: 14px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .balance-amount {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .time-filter {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            background-color: var(--card-bg);
            padding: 8px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .time-filter-btn {
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .time-filter-btn.active {
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .record-list {
            margin-bottom: 70px;
        }

        .record-item {
            background-color: var(--card-bg);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            position: relative;
            transition: all 0.3s;
        }

        .record-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(93, 95, 239, 0.15);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .record-account {
            font-weight: bold;
            color: var(--accent-color);
        }

        .record-amount {
            font-weight: bold;
            font-size: 18px;
        }

        .record-amount.income {
            color: #4caf50;
        }

        .record-amount.expense {
            color: #f44336;
        }

        .record-category {
            display: inline-block;
            padding: 3px 8px;
            background-color: #f0e9ff;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
            color: var(--accent-color);
        }

        .record-note {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .record-comment {
            background-color: #f8f5ff;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            position: relative;
            border-left: 3px solid var(--secondary-color);
        }

        .comment-name {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .record-time {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }

        .add-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            box-shadow: 0 4px 15px rgba(255, 133, 162, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
            border: none;
        }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 133, 162, 0.6);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(93, 95, 239, 0.2);
            position: relative;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: var(--secondary-color);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: #f8f5ff;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .radio-group {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
        }

        .radio-option {
            flex: 1;
            text-align: center;
        }

        .radio-option input {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 12px;
            background-color: #f0e9ff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option label:hover {
            background-color: #e5d9ff;
        }

        .radio-option input:checked + label {
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .category-item {
            padding: 10px;
            text-align: center;
            background-color: #f0e9ff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .category-item:hover {
            background-color: #e5d9ff;
        }

        .category-item.selected {
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 133, 162, 0.4);
        }

        .avatar-modal {
            text-align: center;
        }

        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .avatar-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .avatar-option:hover {
            transform: scale(1.05);
        }

        .avatar-option.selected {
            border-color: var(--secondary-color);
            transform: scale(1.1);
        }

        .upload-container {
            margin: 20px 0;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: #f0e9ff;
            color: var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px dashed var(--accent-color);
            text-align: center;
        }

        .upload-btn:hover {
            background-color: #e5d9ff;
        }

        #avatar-upload {
            display: none;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ccc;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            color: var(--secondary-color);
            transform: scale(1.2);
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: #aaa;
        }

        .edit-name {
            position: absolute;
            top: 10px;
            right: 35px;
            color: #ccc;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .edit-name:hover {
            color: var(--accent-color);
            transform: scale(1.1);
        }

        @media (min-width: 768px) {
            .container {
                max-width: 450px;
            }
        }
    </style>
</head>
<body>
    <!-- 雨滴背景效果 -->
    <div id="rain-container"></div>

    <div class="container">
        <header>
            <div class="logo">笨兔子和小熊猫的恋爱记账本</div>
            <img src="https://i.imgur.com/JqYeYn7.jpg" alt="小熊猫" class="avatar" id="avatar">
        </header>

        <div class="tabs">
            <div class="tab active" id="tab-love">恋爱小金库</div>
            <div class="tab" id="tab-daily">日常开销</div>
        </div>

        <div class="balance-card" id="balance-card">
            <div class="balance-title" id="balance-title">恋爱基金余额</div>
            <div class="balance-amount" id="balance-amount">¥0.00</div>
        </div>

        <div class="time-filter">
            <div class="time-filter-btn active" data-period="all">全部</div>
            <div class="time-filter-btn" data-period="week">本周</div>
            <div class="time-filter-btn" data-period="month">本月</div>
            <div class="time-filter-btn" data-period="year">今年</div>
        </div>

        <div class="record-list" id="record-list">
            <div class="empty-state">暂无记录，点击右下角按钮添加</div>
        </div>

        <button class="add-btn" id="add-btn">+</button>
    </div>

    <!-- 添加记录模态框 -->
    <div class="modal" id="record-modal">
        <div class="modal-content">
            <span class="close-btn" id="close-modal">&times;</span>
            <h3 id="modal-title">添加存款</h3>
            
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" name="record-type" id="income" value="income" checked>
                    <label for="income" id="income-label">存钱</label>
                </div>
                <div class="radio-option">
                    <input type="radio" name="record-type" id="expense" value="expense">
                    <label for="expense" id="expense-label">花钱</label>
                </div>
            </div>

            <div class="form-group">
                <label for="amount">金额</label>
                <input type="number" id="amount" placeholder="输入金额">
            </div>

            <div class="form-group">
                <label for="account">账户</label>
                <select id="account">
                    <option value="微信">微信</option>
                    <option value="支付宝">支付宝</option>
                    <option value="银行卡">银行卡</option>
                </select>
            </div>

            <div class="form-group" id="category-group">
                <label>分类</label>
                <div class="category-grid" id="category-grid">
                    <!-- 分类选项将通过JS动态生成 -->
                </div>
            </div>

            <div class="form-group">
                <label for="note">备注</label>
                <textarea id="note" placeholder="添加备注（可选）"></textarea>
            </div>

            <button class="submit-btn" id="submit-record">确认</button>
        </div>
    </div>

    <!-- 头像选择模态框 -->
    <div class="modal" id="avatar-modal">
        <div class="modal-content avatar-modal">
            <span class="close-btn" id="close-avatar-modal">&times;</span>
            <h3>选择头像</h3>
            <div class="avatar-options" id="avatar-options">
                <img src="https://i.imgur.com/JqYeYn7.jpg" alt="头像1" class="avatar-option selected" data-src="https://i.imgur.com/JqYeYn7.jpg">
                <img src="https://i.imgur.com/8Km9tLL.jpg" alt="头像2" class="avatar-option" data-src="https://i.imgur.com/8Km9tLL.jpg">
                <img src="https://i.imgur.com/nlhLi3I.jpg" alt="头像3" class="avatar-option" data-src="https://i.imgur.com/nlhLi3I.jpg">
                <img src="https://i.imgur.com/QB6T1nQ.jpg" alt="头像4" class="avatar-option" data-src="https://i.imgur.com/QB6T1nQ.jpg">
                <img src="https://i.imgur.com/Z5ouR7d.jpg" alt="头像5" class="avatar-option" data-src="https://i.imgur.com/Z5ouR7d.jpg">
                <img src="https://i.imgur.com/7vQD0fP.jpg" alt="头像6" class="avatar-option" data-src="https://i.imgur.com/7vQD0fP.jpg">
            </div>
            
            <div class="upload-container">
                <label for="avatar-upload" class="upload-btn">上传自定义头像</label>
                <input type="file" id="avatar-upload" accept="image/*">
            </div>
            
            <button class="submit-btn" id="confirm-avatar">确认</button>
        </div>
    </div>

    <script>
        // 初始化数据
        let records = JSON.parse(localStorage.getItem('lingxiao-account-records')) || [];
        let currentTab = 'love';
        let currentPeriod = 'all';
        let currentAvatar = localStorage.getItem('lingxiao-avatar') || 'https://i.imgur.com/JqYeYn7.jpg';
        let ledgerName = {
            love: localStorage.getItem('lingxiao-ledger-name-love') || '恋爱小金库',
            daily: localStorage.getItem('lingxiao-ledger-name-daily') || '日常开销'
        };
        let commentName = localStorage.getItem('lingxiao-comment-name') || '小熊猫';

        // DOM元素
        const tabLove = document.getElementById('tab-love');
        const tabDaily = document.getElementById('tab-daily');
        const balanceTitle = document.getElementById('balance-title');
        const balanceAmount = document.getElementById('balance-amount');
        const balanceCard = document.getElementById('balance-card');
        const recordList = document.getElementById('record-list');
        const addBtn = document.getElementById('add-btn');
        const recordModal = document.getElementById('record-modal');
        const closeModal = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const incomeRadio = document.getElementById('income');
        const expenseRadio = document.getElementById('expense');
        const incomeLabel = document.getElementById('income-label');
        const expenseLabel = document.getElementById('expense-label');
        const amountInput = document.getElementById('amount');
        const accountSelect = document.getElementById('account');
        const categoryGroup = document.getElementById('category-group');
        const categoryGrid = document.getElementById('category-grid');
        const noteTextarea = document.getElementById('note');
        const submitRecord = document.getElementById('submit-record');
        const avatar = document.getElementById('avatar');
        const avatarModal = document.getElementById('avatar-modal');
        const closeAvatarModal = document.getElementById('close-avatar-modal');
        const avatarOptions = document.getElementById('avatar-options');
        const confirmAvatar = document.getElementById('confirm-avatar');
        const timeFilterBtns = document.querySelectorAll('.time-filter-btn');
        const avatarUpload = document.getElementById('avatar-upload');
        const rainContainer = document.getElementById('rain-container');

        // 分类选项
        const categories = {
            love: ['存款'],
            daily: ['零食', '衣服', '交通', '旅行', '话费网费', '学习', '日用品', '美妆', '医疗', '娱乐', '人情往来', '运动', '水电煤', '其他']
        };

        // 小熊猫的评论库
        const comments = {
            deposit: [
                "啧，笨兔子今天存钱了？不错",
                "看来我们的旅行基金又多了点",
                "存这么多，想和我去哪玩",
                "女朋友今天很乖啊",
                "下次livehouse的门票钱有了",
                "存钱的样子还挺可爱",
                "这是要包养我？",
                "啧，别太辛苦",
                "存钱可以，别饿着自己",
                "我们的未来基金+1",
                "今天这么乖，奖励你一杯混合可乐",
                "存钱的速度赶不上我想见你的速度",
                "笨兔子，存钱不如存点时间陪我",
                "啧，看来今晚的宵夜我请",
                "存得不错，继续保持",
                "这是要和我私奔的节奏？",
                "女朋友的理财能力见长",
                "存钱可以，别省着花",
                "我们的恋爱基金又肥了",
                "啧，存这么多想干嘛",
                "看来下个月的约会档次能提高了",
                "笨兔子今天表现不错",
                "存钱的速度可以，但想你的速度更快",
                "这是要买下整个livehouse？",
                "啧，看来我得准备个更大的存钱罐了",
                "女朋友今天格外迷人",
                "存钱的样子让我心动",
                "我们的未来又近了一步",
                "啧，别太累着自己",
                "存钱可以，但别忘记想我"
            ],
            daily: {
                '零食': [
                    "啧，又买零食？",
                    "少吃点垃圾食品",
                    "买这么多吃得完吗",
                    "零食的钱不如省下来见我",
                    "啧，胖了别怪我",
                    "买零食不如买票来看我演出",
                    "女朋友的零食开销有点大啊",
                    "少吃点，晚上带你去吃好的",
                    "啧，零食比我重要？",
                    "买这么多，分我点",
                    "零食可以，别当饭吃",
                    "啧，牙疼别找我",
                    "女朋友的零食清单越来越长了",
                    "买这么多，是给我准备的？",
                    "零食开销超标了笨兔子",
                    "啧，看来得控制你的零花钱了",
                    "买零食的钱够买张来看我的车票了",
                    "少吃点，保持身材",
                    "啧，零食比我还有吸引力？",
                    "女朋友的零食癖好越来越严重了"
                ],
                '衣服': [
                    "啧，又买衣服？",
                    "衣柜还装得下吗",
                    "买这么多穿得过来吗",
                    "衣服的钱不如省下来见我",
                    "啧，穿给我看？",
                    "女朋友的衣品倒是不错",
                    "买新衣服了？下次约会穿",
                    "啧，看来我得努力赚钱了",
                    "衣服可以，别太暴露",
                    "买这么多，是穿给我看的吧",
                    "啧，衣柜要爆炸了",
                    "女朋友的购物欲有点强啊",
                    "买衣服不如买情侣装",
                    "啧，下次我陪你挑",
                    "衣服开销超标了笨兔子",
                    "买这么多，穿给我看就行",
                    "啧，看来得给你买个更大的衣柜",
                    "女朋友穿什么都好看",
                    "买衣服的钱够买张来看我的机票了",
                    "啧，别买太贵的，我不放心"
                ],
                '交通': [
                    "啧，又打车？",
                    "走路锻炼身体不好吗",
                    "交通费这么高，不如搬来和我住",
                    "啧，省钱买辆自行车",
                    "女朋友的出行方式有点奢侈啊",
                    "交通费够买张来看我的票了",
                    "啧，下次我接你",
                    "公共交通更省钱",
                    "交通开销超标了笨兔子",
                    "啧，这么远跑来跑去不累吗",
                    "交通费这么高，不如住我这儿",
                    "女朋友的出行记录有点多啊",
                    "啧，看来得教你骑滑板了",
                    "交通费省下来能多见我几次",
                    "啧，别太累着自己跑来跑去",
                    "交通费这么高，我心疼",
                    "女朋友的出行习惯得改改了",
                    "啧，下次演出我去接你",
                    "交通费够我们吃顿好的了",
                    "啧，别把钱都花在路上"
                ],
                '旅行': [
                    "啧，又去玩？",
                    "旅行不带我？",
                    "玩得开心，注意安全",
                    "啧，下次带我一起",
                    "女朋友的旅行计划挺多啊",
                    "旅行开销有点大啊",
                    "啧，不如来听我演出",
                    "玩得开心，记得想我",
                    "旅行可以，别太累",
                    "啧，照片发我看看",
                    "女朋友的旅行瘾不小啊",
                    "旅行费够我们一起去更远的地方了",
                    "啧，下次我陪你去",
                    "玩得开心，但别玩太久",
                    "旅行开销超标了笨兔子",
                    "啧，看来得计划我们的旅行了",
                    "女朋友的足迹越来越广了",
                    "旅行可以，但别忘记回家",
                    "啧，玩得开心，记得回来",
                    "旅行费省下来能多见我几次"
                ],
                '话费网费': [
                    "啧，话费这么高？",
                    "打电话给我了？",
                    "网费这么贵，来我这蹭网",
                    "啧，话费别欠费，我要找你",
                    "女朋友的通讯开销有点大啊",
                    "话费这么高，多打给我",
                    "啧，网费省下来能买杯奶茶",
                    "话费别省，我要随时找到你",
                    "通讯开销超标了笨兔子",
                    "啧，网络别断，我要视频",
                    "女朋友的话费记录有点多啊",
                    "话费这么高，多说点甜言蜜语",
                    "啧，网费这么贵，来我这上网",
                    "话费别欠费，我要随时骚扰你",
                    "通讯费够我们聊很久了",
                    "啧，网络保持畅通，我要查岗",
                    "女朋友的通讯习惯得改改了",
                    "话费这么高，多说想我",
                    "啧，网费省下来能买张票",
                    "通讯费够我们视频很久了"
                ],
                '学习': [
                    "啧，又买书？",
                    "学习别太累",
                    "买这么多看得完吗",
                    "啧，学习不如学我",
                    "女朋友的学习劲头不错啊",
                    "学习可以，别忘记休息",
                    "啧，书钱够买张票来看我了",
                    "学习别太拼，我心疼",
                    "学习开销超标了笨兔子",
                    "啧，看来我得陪你学习",
                    "女朋友的学习清单越来越长了",
                    "学习可以，但别太累",
                    "啧，书钱省下来能多见我几次",
                    "学习别太拼命，有我呢",
                    "学习开销有点大啊",
                    "啧，看来得给你当辅导老师了",
                    "女朋友的学习习惯不错",
                    "学习可以，但别忘记想我",
                    "啧，书钱够我们吃顿好的了",
                    "学习别太累，我会心疼"
                ],
                '日用品': [
                    "啧，日用品又没了？",
                    "买这么多用得完吗",
                    "日用品开销有点大啊",
                    "啧，别买太便宜的",
                    "女朋友的日常生活挺丰富啊",
                    "日用品可以，别太省",
                    "啧，买这么多是准备搬家？",
                    "日用品开销超标了笨兔子",
                    "啧，看来得帮你拎东西了",
                    "女朋友的购物清单有点长啊",
                    "日用品可以，别太累",
                    "啧，买这么多是给我准备的？",
                    "日用品开销有点高啊",
                    "啧，下次我陪你去买",
                    "女朋友的日常生活挺充实啊",
                    "日用品可以，但别太拼",
                    "啧，买这么多是准备常住？",
                    "日用品开销够我们吃顿好的了",
                    "啧，看来得给你当搬运工了",
                    "女朋友的购物习惯得改改了"
                ],
                '美妆': [
                    "啧，又买化妆品？",
                    "你已经够好看了",
                    "买这么多用得完吗",
                    "啧，化妆不如多睡会",
                    "女朋友的美妆开销有点大啊",
                    "化妆品可以，但别太贵",
                    "啧，素颜就很好看",
                    "美妆开销超标了笨兔子",
                    "啧，看来我得学化妆了",
                    "女朋友的美妆清单越来越长了",
                    "化妆品可以，但别太累",
                    "啧，买这么多是给我看的？",
                    "美妆开销有点高啊",
                    "啧，下次我帮你挑",
                    "女朋友的美妆习惯得改改了",
                    "化妆品可以，但别太拼",
                    "啧，买这么多是准备出道？",
                    "美妆开销够我们吃顿好的了",
                    "啧，看来得给你当化妆师了",
                    "女朋友的美妆品味不错"
                ],
                '医疗': [
                    "啧，生病了？",
                    "别太累着自己",
                    "看病别省钱",
                    "啧，照顾好自己",
                    "女朋友的健康最重要",
                    "医疗开销有点大啊",
                    "啧，别太拼，我心疼",
                    "看病别拖，早点去",
                    "医疗开销超标了笨兔子",
                    "啧，看来得看着你点",
                    "女朋友的健康状况有点差啊",
                    "看病可以，别太省",
                    "啧，别太累，有我呢",
                    "医疗开销有点高啊",
                    "啧，看来得当你的私人医生了",
                    "女朋友的健康习惯得改改了",
                    "看病别怕花钱，健康第一",
                    "啧，别太拼，我会担心",
                    "医疗开销够我们吃顿好的了",
                    "啧，看来得好好照顾你了"
                ],
                '娱乐': [
                    "啧，又去玩？",
                    "玩得开心吗",
                    "娱乐开销有点大啊",
                    "啧，不如来看我演出",
                    "女朋友的娱乐生活挺丰富啊",
                    "娱乐可以，别太晚",
                    "啧，玩得开心，注意安全",
                    "娱乐开销超标了笨兔子",
                    "啧，看来得陪你一起玩",
                    "女朋友的娱乐清单越来越长了",
                    "娱乐可以，但别太累",
                    "啧，玩得开心，记得想我",
                    "娱乐开销有点高啊",
                    "啧，下次带我一起",
                    "女朋友的娱乐习惯得改改了",
                    "娱乐可以，但别太拼",
                    "啧，玩得开心，记得回家",
                    "娱乐开销够我们吃顿好的了",
                    "啧，看来得计划我们的娱乐了",
                    "女朋友的娱乐品味不错"
                ],
                '人情往来': [
                    "啧，又送礼？",
                    "人情开销有点大啊",
                    "送礼别太贵",
                    "啧，心意到就行",
                    "女朋友的人情世故挺多啊",
                    "人情可以，别太累",
                    "啧，送礼不如送时间陪我",
                    "人情开销超标了笨兔子",
                    "啧，看来得教你省钱",
                    "女朋友的人情清单越来越长了",
                    "人情可以，但别太拼",
                    "啧，送礼的钱够买张票了",
                    "人情开销有点高啊",
                    "啧，下次我帮你挑礼物",
                    "女朋友的人情习惯得改改了",
                    "人情可以，但别太贵",
                    "啧，送礼不如送自己",
                    "人情开销够我们吃顿好的了",
                    "啧，看来得帮你处理人情了",
                    "女朋友的人情处理不错"
                ],
                '运动': [
                    "啧，又运动？",
                    "运动别太累",
                    "运动开销有点大啊",
                    "啧，不如跟我骑滑板",
                    "女朋友的运动习惯不错啊",
                    "运动可以，别太拼",
                    "啧，运动完记得休息",
                    "运动开销超标了笨兔子",
                    "啧，看来得陪你运动",
                    "女朋友的运动清单越来越长了",
                    "运动可以，但别太累",
                    "啧，运动钱够买张票了",
                    "运动开销有点高啊",
                    "啧，下次我教你运动",
                    "女朋友的运动习惯得改改了",
                    "运动可以，但别太贵",
                    "啧，运动不如陪我",
                    "运动开销够我们吃顿好的了",
                    "啧，看来得当你的教练了",
                    "女朋友的运动品味不错"
                ],
                '水电煤': [
                    "啧，水电费这么高？",
                    "省着点用",
                    "水电开销有点大啊",
                    "啧，来我这蹭水电",
                    "女朋友的生活开销挺多啊",
                    "水电可以，别太浪费",
                    "啧，水电费省下来能买奶茶",
                    "水电开销超标了笨兔子",
                    "啧，看来得教你省水电",
                    "女朋友的水电记录有点多啊",
                    "水电可以，但别太拼",
                    "啧，水电费够我们聊很久了",
                    "水电开销有点高啊",
                    "啧，下次我帮你交",
                    "女朋友的水电习惯得改改了",
                    "水电可以，但别太贵",
                    "啧，水电费省下来能买张票",
                    "水电开销够我们吃顿好的了",
                    "啧，看来得帮你管理水电了",
                    "女朋友的水电处理不错"
                ],
                '其他': [
                    "啧，这是什么开销？",
                    "花钱别太随便",
                    "其他开销有点大啊",
                    "啧，省着点花",
                    "女朋友的杂项开销挺多啊",
                    "其他可以，别太浪费",
                    "啧，其他开销省下来能买奶茶",
                    "其他开销超标了笨兔子",
                    "啧，看来得教你省钱",
                    "女朋友的其他记录有点多啊",
                    "其他可以，但别太拼",
                    "啧，其他开销够我们聊很久了",
                    "其他开销有点高啊",
                    "啧，下次我帮你处理",
                    "女朋友的其他习惯得改改了",
                    "其他可以，但别太贵",
                    "啧，其他开销省下来能买张票",
                    "其他开销够我们吃顿好的了",
                    "啧，看来得帮你管理了",
                    "女朋友的其他处理不错"
                ]
            }
        };

        // 创建雨滴效果
        function createRain() {
            const rainCount = 50;
            for (let i = 0; i < rainCount; i++) {
                const raindrop = document.createElement('div');
                raindrop.className = 'raindrop';
                
                // 随机位置
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = 1 + Math.random() * 2;
                
                raindrop.style.left = `${left}%`;
                raindrop.style.animationDelay = `${delay}s`;
                raindrop.style.animationDuration = `${duration}s`;
                
                rainContainer.appendChild(raindrop);
            }
        }

        // 初始化
        function init() {
            createRain();
            updateLedgerNames();
            renderRecords();
            updateBalance();
            setupEventListeners();
            avatar.src = currentAvatar;
        }

        // 更新账本名称
        function updateLedgerNames() {
            tabLove.textContent = ledgerName.love;
            tabDaily.textContent = ledgerName.daily;
            
            if (currentTab === 'love') {
                balanceTitle.textContent = '恋爱基金余额';
                incomeLabel.textContent = '存钱';
                expenseLabel.textContent = '花钱';
            } else {
                balanceTitle.textContent = '总消费';
                incomeLabel.textContent = '收入';
                expenseLabel.textContent = '支出';
            }
        }

        // 设置事件监听
        function setupEventListeners() {
            // 标签切换
            tabLove.addEventListener('click', () => switchTab('love'));
            tabDaily.addEventListener('click', () => switchTab('daily'));

            // 时间筛选
            timeFilterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    timeFilterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPeriod = btn.dataset.period;
                    renderRecords();
                });
            });

            // 添加记录
            addBtn.addEventListener('click', openRecordModal);
            closeModal.addEventListener('click', closeRecordModal);

            // 记录类型切换
            incomeRadio.addEventListener('change', updateCategoryOptions);
            expenseRadio.addEventListener('change', updateCategoryOptions);

            // 提交记录
            submitRecord.addEventListener('click', addRecord);

            // 头像相关
            avatar.addEventListener('click', openAvatarModal);
            closeAvatarModal.addEventListener('click', closeAvatarModalFunc);
            confirmAvatar.addEventListener('click', confirmAvatarFunc);

            // 头像选择
            Array.from(avatarOptions.children).forEach(option => {
                option.addEventListener('click', function() {
                    Array.from(avatarOptions.children).forEach(child => child.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // 头像上传
            avatarUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const newAvatar = document.createElement('img');
                        newAvatar.className = 'avatar-option selected';
                        newAvatar.src = event.target.result;
                        newAvatar.dataset.src = event.target.result;
                        
                        // 移除之前的选择
                        Array.from(avatarOptions.children).forEach(child => child.classList.remove('selected'));
                        
                        // 添加新头像
                        avatarOptions.appendChild(newAvatar);
                        newAvatar.addEventListener('click', function() {
                            Array.from(avatarOptions.children).forEach(child => child.classList.remove('selected'));
                            this.classList.add('selected');
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // 切换标签
        function switchTab(tab) {
            currentTab = tab;
            tabLove.classList.toggle('active', tab === 'love');
            tabDaily.classList.toggle('active', tab === 'daily');
            
            updateLedgerNames();
            updateBalance();
            renderRecords();
        }

        // 打开记录模态框
        function openRecordModal() {
            recordModal.style.display = 'flex';
            amountInput.value = '';
            noteTextarea.value = '';
            updateCategoryOptions();
        }

        // 关闭记录模态框
        function closeRecordModal() {
            recordModal.style.display = 'none';
        }

        // 更新分类选项
        function updateCategoryOptions() {
            categoryGrid.innerHTML = '';
            
            const type = incomeRadio.checked ? 'income' : 'expense';
            const currentCategories = type === 'income' ? categories.love : categories.daily;
            
            currentCategories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'category-item';
                item.textContent = category;
                item.dataset.category = category;
                item.addEventListener('click', function() {
                    Array.from(categoryGrid.children).forEach(child => child.classList.remove('selected'));
                    this.classList.add('selected');
                });
                categoryGrid.appendChild(item);
            });
            
            // 默认选择第一个
            if (categoryGrid.firstChild) {
                categoryGrid.firstChild.classList.add('selected');
            }
        }

        // 添加记录
        function addRecord() {
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount <= 0) {
                alert('请输入有效的金额');
                return;
            }

            const type = incomeRadio.checked ? 'income' : 'expense';
            const account = accountSelect.value;
            const note = noteTextarea.value.trim();
            
            const selectedCategory = document.querySelector('.category-item.selected');
            if (!selectedCategory) {
                alert('请选择分类');
                return;
            }
            const category = selectedCategory.dataset.category;

            // 生成小熊猫的评论
            let comment;
            if (currentTab === 'love' && type === 'income') {
                // 恋爱账本的存款
                comment = comments.deposit[Math.floor(Math.random() * comments.deposit.length)];
            } else if (currentTab === 'daily' && type === 'expense') {
                // 日常账本的支出
                const categoryComments = comments.daily[category] || comments.daily['其他'];
                comment = categoryComments[Math.floor(Math.random() * categoryComments.length)];
            } else {
                // 其他情况
                comment = "啧，记账了？";
            }

            const now = new Date();
            const record = {
                id: Date.now(),
                ledger: currentTab,
                type: type,
                amount: amount,
                account: account,
                category: category,
                note: note,
                comment: comment,
                timestamp: now.getTime(),
                date: now.toISOString()
            };

            records.push(record);
            saveRecords();
            renderRecords();
            updateBalance();
            closeRecordModal();
        }

        // 渲染记录列表
        function renderRecords() {
            const filteredRecords = records.filter(record => {
                // 按账本筛选
                if (record.ledger !== currentTab) return false;
                
                // 按时间筛选
                const recordDate = new Date(record.timestamp);
                const now = new Date();
                
                switch (currentPeriod) {
                    case 'week':
                        const startOfWeek = new Date(now);
                        startOfWeek.setDate(now.getDate() - now.getDay());
                        return recordDate >= startOfWeek;
                    case 'month':
                        return recordDate.getMonth() === now.getMonth() && 
                               recordDate.getFullYear() === now.getFullYear();
                    case 'year':
                        return recordDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });

            if (filteredRecords.length === 0) {
                recordList.innerHTML = '<div class="empty-state">暂无记录，点击右下角按钮添加</div>';
                return;
            }

            // 按时间倒序排序
            filteredRecords.sort((a, b) => b.timestamp - a.timestamp);

            recordList.innerHTML = '';
            filteredRecords.forEach(record => {
                const recordDate = new Date(record.timestamp);
                const dateStr = recordDate.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                recordItem.dataset.id = record.id;
                
                let amountClass = record.type === 'income' ? 'income' : 'expense';
                let amountSign = record.type === 'income' ? '+' : '-';
                
                recordItem.innerHTML = `
                    <div class="record-header">
                        <span class="record-account">${record.account}</span>
                        <span class="record-amount ${amountClass}">${amountSign}¥${record.amount.toFixed(2)}</span>
                    </div>
                    <span class="record-category">${record.category}</span>
                    ${record.note ? `<div class="record-note">${record.note}</div>` : ''}
                    <div class="record-comment">
                        <div class="comment-name">${commentName} <span class="edit-name" data-id="${record.id}">✎</span></div>
                        ${record.comment}
                    </div>
                    <div class="record-time">${dateStr}</div>
                    <div class="delete-btn" data-id="${record.id}">×</div>
                `;
                
                recordList.appendChild(recordItem);
            });

            // 添加删除按钮事件
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    deleteRecord(id);
                });
            });

            // 添加编辑评论名称事件
            document.querySelectorAll('.edit-name').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    const newName = prompt('修改评论者名称', commentName);
                    if (newName && newName.trim()) {
                        commentName = newName.trim();
                        localStorage.setItem('lingxiao-comment-name', commentName);
                        renderRecords();
                    }
                });
            });

            // 添加长按编辑账本名称事件
            [tabLove, tabDaily].forEach((tab, index) => {
                tab.addEventListener('longpress', function() {
                    const key = index === 0 ? 'love' : 'daily';
                    const newName = prompt('修改账本名称', ledgerName[key]);
                    if (newName && newName.trim()) {
                        ledgerName[key] = newName.trim();
                        localStorage.setItem(`lingxiao-ledger-name-${key}`, ledgerName[key]);
                        updateLedgerNames();
                    }
                });
            });

            // 模拟长按事件
            let pressTimer;
            [tabLove, tabDaily].forEach(tab => {
                tab.addEventListener('mousedown', function(e) {
                    pressTimer = window.setTimeout(function() {
                        tab.dispatchEvent(new Event('longpress'));
                    }, 1000);
                });
                
                tab.addEventListener('touchstart', function(e) {
                    pressTimer = window.setTimeout(function() {
                        tab.dispatchEvent(new Event('longpress'));
                    }, 1000);
                });
                
                tab.addEventListener('mouseup', function(e) {
                    clearTimeout(pressTimer);
                });
                
                tab.addEventListener('mouseleave', function(e) {
                    clearTimeout(pressTimer);
                });
                
                tab.addEventListener('touchend', function(e) {
                    clearTimeout(pressTimer);
                });
            });
        }

        // 删除记录
        function deleteRecord(id) {
            if (confirm('确定要删除这条记录吗？')) {
                records = records.filter(record => record.id !== id);
                saveRecords();
                renderRecords();
                updateBalance();
            }
        }

        // 更新余额/总消费显示
        function updateBalance() {
            const filteredRecords = records.filter(record => record.ledger === currentTab);
            
            if (currentTab === 'love') {
                // 恋爱基金显示余额
                const income = filteredRecords
                    .filter(r => r.type === 'income')
                    .reduce((sum, r) => sum + r.amount, 0);
                const expense = filteredRecords
                    .filter(r => r.type === 'expense')
                    .reduce((sum, r) => sum + r.amount, 0);
                const balance = income - expense;
                balanceAmount.textContent = `¥${balance.toFixed(2)}`;
                
                // 根据余额变化背景色
                const hue = balance > 0 ? 280 : 350; // 紫色或粉红色
                const saturation = Math.min(100, Math.abs(balance) / 10 * 100);
                balanceCard.style.background = `linear-gradient(135deg, hsl(${hue}, ${saturation}%, 70%), var(--accent-color))`;
            } else {
                // 日常开销显示总支出
                const totalExpense = filteredRecords
                    .filter(r => r.type === 'expense')
                    .reduce((sum, r) => sum + r.amount, 0);
                balanceAmount.textContent = `¥${totalExpense.toFixed(2)}`;
                
                // 根据支出变化背景色
                const hue = 350; // 粉红色
                const saturation = Math.min(100, totalExpense / 1000 * 100);
                balanceCard.style.background = `linear-gradient(135deg, hsl(${hue}, ${saturation}%, 70%), var(--secondary-color))`;
            }
        }

        // 保存记录到本地存储
        function saveRecords() {
            localStorage.setItem('lingxiao-account-records', JSON.stringify(records));
        }

        // 打开头像选择模态框
        function openAvatarModal() {
            avatarModal.style.display = 'flex';
        }

        // 关闭头像选择模态框
        function closeAvatarModalFunc() {
            avatarModal.style.display = 'none';
        }

        // 确认头像选择
        function confirmAvatarFunc() {
            const selected = document.querySelector('.avatar-option.selected');
            if (selected) {
                currentAvatar = selected.dataset.src;
                avatar.src = currentAvatar;
                localStorage.setItem('lingxiao-avatar', currentAvatar);
                closeAvatarModalFunc();
            }
        }

        // 初始化应用
        init();
    </script>
</body>
</html>